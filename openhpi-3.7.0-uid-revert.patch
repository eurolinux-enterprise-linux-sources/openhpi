From d25ba7a4d1ca0b22deb558c51631b383461dfd92 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dan=20Hor=C3=A1k?= <dan@danny.cz>
Date: Tue, 31 Oct 2017 19:15:08 +0100
Subject: [PATCH 1/2] Revert "Fixed compilation warning for Fix #1914"

This reverts commit 981a9eaf532bf6f0ce63af6e22d6784eab4590df.
---
 utils/uid_utils.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/utils/uid_utils.c b/utils/uid_utils.c
index 6315a56e..ee320f2b 100644
--- a/utils/uid_utils.c
+++ b/utils/uid_utils.c
@@ -480,7 +480,7 @@ static gint uid_map_from_file()
 		 if(stat(VARPATH, &buf) < 0) {
 	  	 	CRIT("uid map file directory '%s' does not exist. Either "
 				"re-install the package or create the directory "
-				"maunally.", VARPATH);
+				"maunally.", VARPATH, VARPATH);
 			return -2;
 		 }
 
-- 
2.13.6


From ae0fa7c105d68e8a98bcd6ffd81382fd3c0a64c7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dan=20Hor=C3=A1k?= <dan@danny.cz>
Date: Tue, 31 Oct 2017 19:15:22 +0100
Subject: [PATCH 2/2] Revert "Fix for #1914 uid_map creation fails if directory
 is missing "

This reverts commit c3073f79dbddfd866a09b0186db897c5673fb623.
---
 utils/uid_utils.c | 19 +------------------
 1 file changed, 1 insertion(+), 18 deletions(-)

diff --git a/utils/uid_utils.c b/utils/uid_utils.c
index ee320f2b..f7d815f7 100644
--- a/utils/uid_utils.c
+++ b/utils/uid_utils.c
@@ -169,13 +169,6 @@ SaErrorT oh_uid_initialize(void)
                 if (cc != 0) {
                         g_free(oh_uid_map_file);
                         oh_uid_map_file = 0;
-
-                        if (cc == -2) {
-                                WARN("UID map file directory does not exist.");
-                                uid_unlock(&oh_uid_lock);
-                                return -1;
-                        }
-
                         WARN( "Disabling using UID Map file." );
                         WARN( "Resource Id will not be persistent." );
                 }
@@ -459,14 +452,12 @@ static void write_ep_xref(gpointer key, gpointer value, gpointer fp)
  * This function, if a uid map file exists, reads the current value for
  * uid and intializes the memory resident uid map file from file.
  *
- * Return value: success 0, error -1, uid map file directory 
- * does not exist -2.
+ * Return value: success 0, error -1.
  */
 static gint uid_map_from_file()
 {
         FILE *fp;
         int rval;
-	struct stat buf;
 #ifndef _WIN32
 	mode_t prev_umask;
 #endif
@@ -476,14 +467,6 @@ static gint uid_map_from_file()
         }
         fp = fopen(oh_uid_map_file, "rb");
         if(!fp) {
-		 /* Check for the existence of uid map file directory. */
-		 if(stat(VARPATH, &buf) < 0) {
-	  	 	CRIT("uid map file directory '%s' does not exist. Either "
-				"re-install the package or create the directory "
-				"maunally.", VARPATH, VARPATH);
-			return -2;
-		 }
-
                  /* create map file with resource id initial value */
                  WARN("uid_map file '%s' could not be opened, initializing", oh_uid_map_file);
 #ifndef _WIN32
-- 
2.13.6

